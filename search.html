<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SereneSeek - Find & Compare</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Manrope', sans-serif;
            background-image: url('https://images.unsplash.com/photo-1618220179428-22790b461013?q=80&w=2127&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #3d5a59;
            text-shadow: 0px 1px 3px rgba(255, 255, 255, 0.2);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.45);
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px 0 rgba(90, 125, 124, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass-card:hover {
        .glass-card:hover:not(.filter-sidebar) {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px 0 rgba(90, 125, 124, 0.15);
        }
@@ -48,6 +48,10 @@
            height: 1rem;
            display: inline-block;
        }
        .rating-filter-label .star {
             width: 1.25rem;
             height: 1.25rem;
        }
    </style>
</head>

@@ -76,24 +80,55 @@
    </header>

    <main class="container mx-auto p-4 mt-8 flex-grow">
        <div class="flex justify-between items-center mb-8">
        <div id="content-area">
            <!-- Initial Message -->
            <div id="message-container" class="text-center p-8 glass-card max-w-2xl mx-auto">
                <h2 id="message-title" class="text-2xl font-semibold">Start your search to find beautiful items.</h2>
                <p id="message-subtitle" class="text-lg opacity-80">Results will appear here.</p>
            </div>
            <div id="controls-container" class="hidden">
                 <div class="glass-card p-2 flex items-center space-x-2">
                    <label for="sort-by" class="font-semibold text-sm px-2">Sort by:</label>
                    <select id="sort-by" class="bg-white/70 rounded-lg px-3 py-2 border-2 border-transparent focus:outline-none focus:border-teal-500 text-sm">
                        <option value="default">Relevance</option>
                        <option value="price-low-high">Price: Low to High</option>
                        <option value="price-high-low">Price: High to Low</option>
                        <option value="rating-high-low">Rating: High to Low</option>
                    </select>

            <!-- Results View (hidden initially) -->
            <div id="results-view" class="hidden grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- Sidebar -->
                <aside id="sidebar" class="lg:col-span-1">
                    <div class="glass-card filter-sidebar p-4 sticky top-28">
                        <h3 class="text-xl font-bold mb-4">Filter & Sort</h3>
                        <!-- Sort Control -->
                        <div class="mb-6">
                            <label for="sort-by" class="font-semibold text-sm block mb-2">Sort by:</label>
                            <select id="sort-by" class="w-full bg-white/70 rounded-lg px-3 py-2 border-2 border-transparent focus:outline-none focus:border-teal-500 text-sm">
                                <option value="default">Relevance</option>
                                <option value="price-low-high">Price: Low to High</option>
                                <option value="price-high-low">Price: High to Low</option>
                                <option value="rating-high-low">Rating: High to Low</option>
                            </select>
                        </div>
                        <!-- Rating Filter -->
                        <div class="mb-6">
                            <label class="font-semibold text-sm block mb-2">Rating:</label>
                            <div id="rating-filter" class="space-y-2">
                                <!-- JS will generate checkboxes here -->
                            </div>
                        </div>
                         <!-- Price Filter -->
                        <div>
                            <label class="font-semibold text-sm block mb-2">Price Range:</label>
                            <div class="flex items-center space-x-2">
                                <input type="number" id="min-price" placeholder="Min" class="w-full placeholder-sage bg-white/70 rounded-lg px-3 py-2 border-2 border-transparent focus:outline-none focus:border-teal-500 text-sm">
                                <span>-</span>
                                <input type="number" id="max-price" placeholder="Max" class="w-full placeholder-sage bg-white/70 rounded-lg px-3 py-2 border-2 border-transparent focus:outline-none focus:border-teal-500 text-sm">
                            </div>
                        </div>
                    </div>
                </aside>

                <!-- Search Results -->
                <div id="search-results-wrapper" class="lg:col-span-3">
                     <p id="results-count" class="text-white/90 font-semibold mb-4 text-lg"></p>
                     <div id="search-results" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-8"></div>
                </div>
            </div>
        </div>
        <div id="search-results" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
    </main>

    <footer class="text-center p-4 mt-auto">
@@ -113,14 +148,18 @@
        const messageContainer = document.getElementById('message-container');
        const messageTitle = document.getElementById('message-title');
        const messageSubtitle = document.getElementById('message-subtitle');
        const resultsView = document.getElementById('results-view');
        const searchResultsContainer = document.getElementById('search-results');
        const cartCountEl = document.getElementById('cart-count');
        const controlsContainer = document.getElementById('controls-container');
        const sortByEl = document.getElementById('sort-by');
        const ratingFilterEl = document.getElementById('rating-filter');
        const minPriceEl = document.getElementById('min-price');
        const maxPriceEl = document.getElementById('max-price');
        const resultsCountEl = document.getElementById('results-count');

        // --- APP STATE ---
        let cart = JSON.parse(localStorage.getItem('sereneSeekCart')) || [];
        let currentProducts = [];
        let allProducts = [];

        // --- CART LOGIC ---
        function updateCartCount() {
@@ -151,33 +190,17 @@
            sessionStorage.setItem('sereneSeekLastQuery', query);
            performSearch(query);
        });

        sortByEl.addEventListener('change', () => {
            let sortedProducts = [...currentProducts];
            const sortValue = sortByEl.value;

            switch (sortValue) {
                case 'price-low-high':
                    sortedProducts.sort((a, b) => (a.price || Infinity) - (b.price || Infinity));
                    break;
                case 'price-high-low':
                    sortedProducts.sort((a, b) => (b.price || 0) - (a.price || 0));
                    break;
                case 'rating-high-low':
                    sortedProducts.sort((a, b) => (b.rating || 0) - (a.rating || 0));
                    break;
                case 'default':
                    // Use the original order stored in currentProducts
                    break;
            }
            displayResults(sortedProducts, false); // Don't reset master list
        
        [sortByEl, minPriceEl, maxPriceEl].forEach(el => {
            el.addEventListener('change', applyFiltersAndDisplay);
        });
        ratingFilterEl.addEventListener('change', applyFiltersAndDisplay);


        // --- SEARCH & DISPLAY LOGIC ---
        async function performSearch(query) {
            messageContainer.style.display = 'block';
            controlsContainer.style.display = 'none';
            resultsView.style.display = 'none';
            messageTitle.textContent = 'Searching for deals...';
            messageSubtitle.textContent = 'Please wait a moment.';
            searchResultsContainer.innerHTML = '';
@@ -201,8 +224,9 @@
                            jsonString = jsonString.substring(0, lastBracketIndex + 1) + ']';
                            const products = JSON.parse(jsonString);
                            sessionStorage.setItem('sereneSeekLastResults', JSON.stringify(products));
                            sortByEl.value = 'default';
                            displayResults(products, true);
                            allProducts = products;
                            resetFilters();
                            applyFiltersAndDisplay();
                        } else {
                            throw new Error("No valid JSON object found.");
                        }
@@ -220,39 +244,70 @@
            }
        }

        function generateStarRating(rating) {
        function applyFiltersAndDisplay() {
            let filteredProducts = [...allProducts];

            // Get filter values
            const sortValue = sortByEl.value;
            const minPrice = parseFloat(minPriceEl.value) || 0;
            const maxPrice = parseFloat(maxPriceEl.value) || Infinity;
            const selectedRatings = [...ratingFilterEl.querySelectorAll('input:checked')].map(el => parseInt(el.value));

            // Apply filters
            if (selectedRatings.length > 0) {
                filteredProducts = filteredProducts.filter(p => p.rating && selectedRatings.some(r => p.rating >= r && p.rating < r + 1));
            }

            filteredProducts = filteredProducts.filter(p => {
                const price = p.price || 0;
                return price >= minPrice && price <= maxPrice;
            });

            // Apply sorting
            switch (sortValue) {
                case 'price-low-high':
                    filteredProducts.sort((a, b) => (a.price || Infinity) - (b.price || Infinity));
                    break;
                case 'price-high-low':
                    filteredProducts.sort((a, b) => (b.price || 0) - (a.price || 0));
                    break;
                case 'rating-high-low':
                    filteredProducts.sort((a, b) => (b.rating || 0) - (a.rating || 0));
                    break;
            }

            displayResults(filteredProducts);
        }

        function generateStarRating(rating, forFilter = false) {
            const totalStars = 5;
            let starsHTML = '';
            if (typeof rating !== 'number' || rating < 0) {
                return '<span class="text-sm opacity-70">No rating</span>';
            }
            const ratingValue = forFilter ? Math.floor(rating) : rating;

            for (let i = 1; i <= totalStars; i++) {
                if (i <= rating) {
                if (i <= ratingValue) {
                    starsHTML += `<svg class="star text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>`;
                } else {
                    starsHTML += `<svg class="star text-gray-300" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>`;
                }
            }
            if (forFilter) return starsHTML;
            return `<div class="flex items-center">${starsHTML}<span class="ml-2 text-sm text-gray-600">${rating.toFixed(1)}</span></div>`;
        }


        function displayResults(results, isNewSearch) {
            if (isNewSearch) {
                currentProducts = [...results];
            }
            
            if (!Array.isArray(results) || results.length === 0) {
                displayError(`No results found for "${searchInput.value}".`, "Try a different search term.");
                return;
            }

        function displayResults(products) {
            messageContainer.style.display = 'none';
            controlsContainer.style.display = 'flex';
            resultsView.style.display = 'grid';
            searchResultsContainer.innerHTML = '';
            resultsCountEl.textContent = `${products.length} results found.`;

            results.forEach(product => {
            if (products.length === 0) {
                searchResultsContainer.innerHTML = `<p class="text-white/80 col-span-full text-center">No products match your current filters.</p>`;
                return;
            }

            products.forEach(product => {
                const imageUrl = product.image || `https://placehold.co/400x400/A0BCC0/3d5a59?text=SereneSeek`;
                const title = product.title || 'Untitled Product';
                const source = product.source || 'Unknown Store';
@@ -292,15 +347,35 @@

        function displayError(title, subtitle) {
            messageContainer.style.display = 'block';
            controlsContainer.style.display = 'none';
            searchResultsContainer.innerHTML = '';
            resultsView.style.display = 'none';
            messageTitle.textContent = title;
            messageSubtitle.textContent = subtitle;
        }
        
        function populateRatingFilter() {
            ratingFilterEl.innerHTML = '';
            for (let i = 5; i >= 1; i--) {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-3 cursor-pointer rating-filter-label';
                label.innerHTML = `
                    <input type="checkbox" value="${i}" class="h-5 w-5 rounded border-gray-300 text-teal-600 focus:ring-teal-500">
                    <span class="flex items-center">${generateStarRating(i, true)}</span>
                `;
                ratingFilterEl.appendChild(label);
            }
        }

        function resetFilters() {
            sortByEl.value = 'default';
            minPriceEl.value = '';
            maxPriceEl.value = '';
            ratingFilterEl.querySelectorAll('input').forEach(input => input.checked = false);
        }

        // --- ON PAGE LOAD ---
        document.addEventListener('DOMContentLoaded', () => {
            updateCartCount();
            populateRatingFilter();
            const lastResultsJSON = sessionStorage.getItem('sereneSeekLastResults');
            const lastQuery = sessionStorage.getItem('sereneSeekLastQuery');

@@ -310,8 +385,8 @@

            if (lastResultsJSON) {
                try {
                    const products = JSON.parse(lastResultsJSON);
                    displayResults(products, true);
                    allProducts = JSON.parse(lastResultsJSON);
                    applyFiltersAndDisplay();
                } catch(e) {
                    console.error("Could not parse saved results", e);
                    sessionStorage.removeItem('sereneSeekLastResults');
